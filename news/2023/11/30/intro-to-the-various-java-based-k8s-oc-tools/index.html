<!DOCTYPE html>
<html>

<head>
  <script id="adobe_dtm" src="//www.redhat.com/dtm.js" type="text/javascript"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Introduction to the various Java based Kubernetes/OpenShift tools and their usages in WildFly related projects</title>
  <meta name="description" content="An introduction to the various Java based Kubernetes/OpenShift tools and their usages in WildFly related projects">
  <link rel="me" href="https://fosstodon.org/@wildflyas" />
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/base16/atelier-dune-light.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/protobuf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/dockerfile.min.js"></script>
  <link rel="stylesheet" href="/assets/css/main.css" />
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-40221748-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-40221748-1');
  </script>

  

</head>

<body class="Introduction to the various Java based Kubernetes/OpenShift tools and their usages in WildFly related projects">
  <div class="content">
    <div class="header navigation">
  <div class="logo-wrapper">
    <a href="/"><img class="wf-logo" src="/assets/img/wildfly_icons_one-color-logo.png"></a>
  </div>
  <div class="nav-container">
    <nav>
      <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
      <ul class="nav-list">
        <li>
          <a href="/news/" class="active">News</a>
        </li>
        <li>
          <a href="/about/" class="">About</a>
        </li>
        <li>
          <a href="/contribute/" class="">Contribute</a>
        </li>
        <li>
            <a target="_blank" href="https://docs.wildfly.org">Docs</a>
        </li>
        <li>
          <a href="/guides/" class="">Guides</a>
        </li>
        <li>
          <a href="/downloads/" class="">Downloads</a>
        </li>
        <li>
          <a href="/security/" class="">CVE Reporting</a>
        </li>
        <li>
          <a href="https://github.com/wildfly/wildfly/fork" target="_blank">Fork</a>
        </li>
        <li>
          <a class="button-cta secondary " href="/get-started/">Get Started</a>
        </li>
      </ul>
    </nav>
  </div>
</div>

    <div class="post-page grid-wrapper">
  <div class="grid__item width-10-12">
    <h1 class="title">Introduction to the various Java based Kubernetes/OpenShift tools and their usages in WildFly related projects</h1>
    
    
    

    <p>
      
        
          
          <p class="byline">
            
              <img class="avatar" height="60px" width="60px" src="/assets/img/authors/liweinan.jpg"/>
            

            By 阿男
            
              | November 30, 2023
            
          </p>
        
      
    </p>
  </div>
  <div class="grid__item width-10-12 doc-content">
    
    <div class="paragraph">
<p>There are various Java based Kubernetes/OpenShift related tools that  have different functions, and some of their functions are overlapping. Here is the (partial) list of these tools:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://dekorate.io/">Dekorate</a></p>
</li>
<li>
<p><a href="https://github.com/eclipse/jkube">eclipse/jkube: Build and Deploy java applications on Kubernetes</a></p>
</li>
<li>
<p><a href="https://github.com/fabric8io/kubernetes-client">fabric8io/kubernetes-client: Java client for Kubernetes &amp; OpenShift</a></p>
</li>
<li>
<p><a href="https://github.com/fabric8io/docker-maven-plugin">fabric8io/docker-maven-plugin</a></p>
</li>
<li>
<p><a href="https://github.com/GoogleContainerTools/jib">GoogleContainerTools/jib</a></p>
</li>
<li>
<p><a href="https://github.com/wildfly/wildfly-maven-plugin">wildfly-maven-plugin: WildFly Application Server Maven Plugin</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All the above tools can be used as Maven plugin, and they can be used together if necessary(Which is determined by the requirements). In this article I’d like to give a brief introduction to these tools and see their usages in some WildFly related projects as examples. Firstly we can go through these projects.</p>
</div>
<div class="sect1">
<h2 id="dekorate">Dekorate</h2>
<div class="sectionbody">
<div class="paragraph">
<p>From its <a href="https://dekorate.io/">website</a> the project introduction is written as:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Dekorate is a one-stop jar to Kubernetes manifest generation that works for all jvm languages regardless of your build tool. It makes generating Kubernetes manifests as easy as adding a dependency to the classpath. Stop wasting time editing xml, json and yml and customize the kubernetes manifests as you configure your java application.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>In general, the <code>dekorate</code> allows users to generate k8s manifest file according to the annotations it provided. For example, it provides the annotation <code>@KubernetesApplication</code> that can trigger the manifest file generation. In addition, it also provides annotation <code>@DockerBuild</code> that can trigger the docker build. Please note that Dekorate does not generate <code>Dockerfile</code>. It expects to find one in the root of the module, and it will call the <code>docker</code> command to build the image by using the installed local docker daemon. There is an article that introduces its usage<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="eclipse-jkube">Eclipse JKube</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Eclipse JKube can generate <code>Dockerfile</code> and do the docker image build, and it can generate Kubernetes/OpenShift manifests, and do the k8s/openshift deployment. There is an article from <code>developers.redhat.com</code> <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> that describes the history of the project, and here is part of the text quoted from the article:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>This project was not built from scratch. It’s just a refactored and rebranded version of the <a href="https://github.com/fabric8io/fabric8-maven-plugin">Fabric8 Maven plugin</a>, which was a Maven plugin used in the <a href="http://fabric8.io/">Fabric8</a> ecosystem. Although the Fabric8 project was liked and appreciated by many people in the open source community, due to unfortunate reasons it could not become successful, and the idea of Fabric8 as an integrated development platform on top of Kubernetes died.</p>
</div>
<div class="paragraph">
<p>Although the main project is archived, there are still active repositories used by the community, such as the <a href="https://github.com/fabric8io/docker-maven-plugin">Fabric8 Docker Maven plugin</a>, the <a href="https://github.com/fabric8io/kubernetes-client">Fabric8 Kubernetes client</a>, and of course the Fabric8 Maven plugin.</p>
</div>
<div class="paragraph">
<p>As maintainers of the Fabric8 Maven plugin, we started decoupling the Fabric8 ecosystem related pieces from the plugin to make a general-purpose Kubernetes/OpenShift plugin.</p>
</div>
<div class="paragraph">
<p>We also felt there was a need for rebranding because most people were confused about whether this plugin had something to do with Fabric8. Hence, we decided to rebrand it, and fortunately, someone from the Eclipse foundation approached us to take in our project.</p>
</div>
<div class="paragraph">
<p>Now, the project is being renamed to Eclipse JKube and can be <a href="https://github.com/eclipse/jkube">found in the Eclipse Foundation repos on GitHub</a>.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>And here is its design:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Eclipse JKube can be seen as a reincarnation of the Fabric8 Maven plugin. It contains the good parts of this plugin and offers a clean and smooth workflow with the tooling it provides. We refactored this plugin into three components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/eclipse/jkube/tree/master/jkube-kit">The JKube Kit</a></p>
</li>
<li>
<p><a href="https://github.com/eclipse/jkube/tree/master/kubernetes-maven-plugin">The
Kubernetes Maven plugin</a></p>
</li>
<li>
<p><a href="https://github.com/eclipse/jkube/tree/master/openshift-maven-plugin">The
OpenShift Maven plugin</a></p>
</li>
</ul>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Unlike the Dekorate project, which focus on k8s manifest file generation, and provide fine-grained annotations to control the generation process, JKube run as a maven plugin can help to generate a simple <code>Dockerfile</code> based on the project used frameworks<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup>. In addition, the JKube can generate k8s manifest files and do the k8s/openshift deployments. I have written a blog post showing its usage<sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>Comparing with other tools, the JKube can do various tasks, which is very convenient. Nevertheless, other tools may focus on more specific task and provide some more fine grain controls to the task it takes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fabric8-docker-maven-plugin">Fabric8 Docker Maven plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As already introduced in above Eclipse JKube section, the <a href="https://github.com/fabric8io/docker-maven-plugin">Fabric8 Docker Maven plugin</a> is part of the Fabric8 ecosystem. This project is focusing on the Docker image related tasks. It can define a docker image in its maven plugin configuration without having a <code>Dockerfile</code>, and it can do the container deployment/undeployment during the Maven integration test phase. We will see this plugin usage later.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fabric8-kubernetes-client">Fabric8 Kubernetes Client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As the name suggests, this project provides Java based client to interact with the Kubernetes and OpenShift services. The functions of this Java based client is similar to the <code>kubectl</code> and <code>oc</code> commands. So this tool is convenient to use for writing k8s and OpenShift related tests.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jib">jib</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>jib</code> is a tool provided by Google, and it can be used to build images without Docker daemon installed, so it can produce a docker image standalone.</p>
</div>
<div class="paragraph">
<p>After introducing the above tools, I’ll give an introduction to see their usages in some WildFly related projects as examples.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="wildfly-maven-plugin">wildfly-maven-plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>wildfly-maven-plugin</code> integrates the Galleon features which can build a provisioned WildFly server on-the-fly during the Maven package or testing phases, and it can control the start/stop of the provisioned server and the deployment of the host project. In addition, the plugin can be used to build a docker image that includes the provisioned WildFly server and the deployed project.</p>
</div>
<div class="paragraph">
<p>To see more of the details on the usages of the plugin, you can check these related articles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.wildfly.org/wildfly-maven-plugin/releases/4.2/package-example.html">WildFly Maven Plugin – Package your application</a></p>
</li>
<li>
<p><a href="https://docs.wildfly.org/wildfly-maven-plugin/releases/4.2/image-example.html">WildFly Maven Plugin – Build and push your application in a container image</a></p>
</li>
<li>
<p><a href="https://www.wildfly.org/news/2022/08/04/wildfly-maven-docker/">Use the wildfly-maven-plugin to create a Docker image of your application</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usage-of-the-above-tools-in-wildfly-related-projects">Usage of the above tools in WildFly related projects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Next we can see the <code>wildfly-cloud-tests</code> <sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup> project(Currently it has an Alpha release: <a href="https://github.com/wildfly-extras/wildfly-cloud-tests/releases/tag/1.0.0.Alpha2">wildfly-cloud-tests / 1.0.0.Alpha2</a>). It is a good material to learn how to test WildFly under cloud based environment, and what tools it used. I have written a personal blog post<sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnotedef_6" title="View footnote.">6</a>]</sup> describing its usage.</p>
</div>
<div class="paragraph">
<p>Firstly, this project uses the <a href="https://github.com/fabric8io/docker-maven-plugin"><code>docker-maven-plugin</code></a> to do the test images build<sup class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnotedef_7" title="View footnote.">7</a>]</sup>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;io.fabric8&lt;/groupId&gt;
    &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;id&gt;build-server&lt;/id&gt;
            &lt;phase&gt;process-test-classes&lt;/phase&gt;
            &lt;goals&gt;
                &lt;goal&gt;build&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
                &lt;skip&gt;${wildfly.cloud.test.skip.image}&lt;/skip&gt;
                &lt;images&gt;
                    &lt;image&gt;
                        &lt;name&gt;wildfly-cloud-test-image/${project.name}:latest&lt;/name&gt;
                        &lt;alias&gt;server&lt;/alias&gt;
                        &lt;build&gt;
                            &lt;from&gt;${image.name.wildfly.runtime}&lt;/from&gt;
                            &lt;assembly&gt;
                                &lt;mode&gt;dir&lt;/mode&gt;
                                &lt;user&gt;jboss:root&lt;/user&gt;
                                &lt;targetDir&gt;/opt/server&lt;/targetDir&gt;
                                &lt;inline&gt;
                                    &lt;formats&gt;
                                        &lt;format&gt;dir&lt;/format&gt;
                                    &lt;/formats&gt;
                                    &lt;fileSets&gt;
                                        &lt;fileSet&gt;
                                            &lt;directory&gt;target/server&lt;/directory&gt;
                                            &lt;outputDirectory&gt;/&lt;/outputDirectory&gt;
                                            &lt;includes&gt;
                                                &lt;include&gt;**&lt;/include&gt;
                                            &lt;/includes&gt;
                                        &lt;/fileSet&gt;
                                    &lt;/fileSets&gt;
                                &lt;/inline&gt;
                            &lt;/assembly&gt;
                        &lt;/build&gt;
                    &lt;/image&gt;
                &lt;/images&gt;
            &lt;/configuration&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Secondly, this project uses Dekorate to generate the k8s manifest<sup class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnotedef_8" title="View footnote.">8</a>]</sup>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.dekorate&lt;/groupId&gt;
    &lt;artifactId&gt;dekorate-bom&lt;/artifactId&gt;
    &lt;version&gt;${version.io.decorate.dekorate}&lt;/version&gt;
    &lt;type&gt;pom&lt;/type&gt;
    &lt;scope&gt;import&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thirdly, the project uses the <code>io.fabric8:kubernetes-client</code> to interact with k8s/OpenShift in its test cases<sup class="footnote">[<a id="_footnoteref_9" class="footnote" href="#_footnotedef_9" title="View footnote.">9</a>]</sup>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.fabric8&lt;/groupId&gt;
    &lt;artifactId&gt;kubernetes-client&lt;/artifactId&gt;
    &lt;version&gt;${version.io.fabric8.kubernetes-client}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>I won’t go into details of these component usages here, if you are interested how these components are used in the project, you can check the next section of this article.</p>
</div>
<div class="paragraph">
<p>The last project to learn about is <a href="https://github.com/jbossws/jbossws-cxf"><code>jbossws-cxf</code></a>. Currently, the project is using <code>docker-maven-plugin</code> to generate the Docker image<sup class="footnote">[<a id="_footnoteref_10" class="footnote" href="#_footnotedef_10" title="View footnote.">10</a>]</sup>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
      &lt;groupId&gt;io.fabric8&lt;/groupId&gt;
      &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;
      &lt;executions&gt;
          &lt;execution&gt;
              &lt;id&gt;build-wildfly-images&lt;/id&gt;
              &lt;phase&gt;pre-integration-test&lt;/phase&gt;
              &lt;goals&gt;
                  &lt;goal&gt;build&lt;/goal&gt;
                  &lt;goal&gt;push&lt;/goal&gt;
              &lt;/goals&gt;
              &lt;configuration&gt;
                  &lt;images&gt;
                      &lt;image&gt;
                          &lt;name&gt;localhost:5000/wildfly-webservice:latest&lt;/name&gt;
                          &lt;build&gt;
                              &lt;from&gt;quay.io/wildfly/wildfly-runtime:latest&lt;/from&gt;
                              &lt;assembly&gt;
                                  &lt;mode&gt;dir&lt;/mode&gt;
                                  &lt;user&gt;jboss:root&lt;/user&gt;
                                  &lt;targetDir&gt;/opt/server&lt;/targetDir&gt;
                                  &lt;inline&gt;
                                      &lt;formats&gt;
                                          &lt;format&gt;dir&lt;/format&gt;
                                      &lt;/formats&gt;
                                      &lt;fileSets&gt;
                                          &lt;fileSet&gt;
                                              &lt;directory&gt;target/server&lt;/directory&gt;
                                              &lt;outputDirectory&gt;/&lt;/outputDirectory&gt;
                                              &lt;includes&gt;
                                                  &lt;include&gt;**&lt;/include&gt;
                                              &lt;/includes&gt;
                                          &lt;/fileSet&gt;
                                      &lt;/fileSets&gt;
                                  &lt;/inline&gt;
                              &lt;/assembly&gt;
                          &lt;/build&gt;
                      &lt;/image&gt;
                  &lt;/images&gt;
              &lt;/configuration&gt;
          &lt;/execution&gt;
      &lt;/executions&gt;
  &lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, it uses the <code>kubernetes-client</code> to deploy the image to the k8s/openshift platform. In the project team blog there is an article describes its cloud based test<sup class="footnote">[<a id="_footnoteref_11" class="footnote" href="#_footnotedef_11" title="View footnote.">11</a>]</sup>. In addition, you can check the project CI<sup class="footnote">[<a id="_footnoteref_12" class="footnote" href="#_footnotedef_12" title="View footnote.">12</a>]</sup> to see how the cloud based tests are running in GitHub CI environment. At last the project also contains profile that is using the <code>jib</code> to build the docker image<sup class="footnote">[<a id="_footnoteref_13" class="footnote" href="#_footnotedef_13" title="View footnote.">13</a>]</sup>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;profile&gt;
    &lt;id&gt;jib&lt;/id&gt;
    &lt;activation&gt;
        &lt;property&gt;
            &lt;name&gt;image.builder&lt;/name&gt;
            &lt;value&gt;jib&lt;/value&gt;
        &lt;/property&gt;
    &lt;/activation&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.wildfly.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;wildfly-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;feature-packs&gt;
                        &lt;feature-pack&gt;
                            &lt;location&gt;org.jboss.ws.cxf:jbossws-cxf-feature-pack:${project.version}&lt;/location&gt;
                        &lt;/feature-pack&gt;
                        &lt;feature-pack&gt;
                            &lt;location&gt;org.wildfly:wildfly-galleon-pack:${jboss.version}&lt;/location&gt;
                        &lt;/feature-pack&gt;
                    &lt;/feature-packs&gt;
                    &lt;layers&gt;
                        &lt;layer&gt;cloud-server&lt;/layer&gt;
                        &lt;layer&gt;webservices&lt;/layer&gt;
                    &lt;/layers&gt;
                    &lt;filename&gt;${warName}.war&lt;/filename&gt;
                &lt;/configuration&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;phase&gt;pre-integration-test&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;package&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;com.google.cloud.tools&lt;/groupId&gt;
                &lt;artifactId&gt;jib-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;from&gt;
                        &lt;image&gt;quay.io/wildfly/wildfly-runtime:latest&lt;/image&gt;
                    &lt;/from&gt;
                    &lt;to&gt;
                        &lt;image&gt;${imageName}:${imageTag}&lt;/image&gt;
                    &lt;/to&gt;
                    &lt;extraDirectories&gt;
                        &lt;paths&gt;
                            &lt;path&gt;
                                &lt;from&gt;target/server&lt;/from&gt;
                                &lt;into&gt;/opt/server&lt;/into&gt;
                            &lt;/path&gt;
                        &lt;/paths&gt;
                        &lt;permissions&gt;
                            &lt;permission&gt;
                                &lt;file&gt;/opt/server/**/*&lt;/file&gt;
                                &lt;mode&gt;770&lt;/mode&gt;
                            &lt;/permission&gt;
                        &lt;/permissions&gt;
                    &lt;/extraDirectories&gt;
                    &lt;container&gt;
                        &lt;user&gt;root&lt;/user&gt;
                    &lt;/container&gt;
                &lt;/configuration&gt;

                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;phase&gt;pre-integration-test&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;dockerBuild&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Until now, we have checked the usages of these tools in several projects.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="some-notes-on-the-implementation-of-the-wildfly-cloud-tests-project">Some notes on the implementation of the wildfly-cloud-tests project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>wildfly-cloud-tests</code> uses these tools to do complex WildFly based tests, so it’s a good material to learn about how to use these tools in depth. One internal class that may worth checking is the <code>WildFlyCommonExtension</code> <sup class="footnote">[<a id="_footnoteref_14" class="footnote" href="#_footnotedef_14" title="View footnote.">14</a>]</sup>. Here is its class diagram:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/assets/img/news/2023-09-20-k8s/WildFlyCommonExtension.jpg" alt="image"></span></p>
</div>
<div class="paragraph">
<p>It works as a JUnit extension that take cares of the image deployment to k8s/openshift. For example, it provides methods to deploy/undeploy the k8s resources(please note these internal implementations may change in the future, and it&#8217;s shown here just for expressing the idea):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private void startResourcesInList(ExtensionContext context, KubernetesResource kubernetesResource, KubernetesList resourceList) {
        KubernetesClient client = getKubernetesClient(context);
        resourceList.getItems().stream()
                .forEach(i -&gt; {
                    client.resourceList(i).createOrReplace();
                    System.out.println("Created: " + i.getKind() + " name:" + i.getMetadata().getName() + ".");
                });

        List&lt;HasMetadata&gt; waitables = resourceList.getItems().stream().filter(i -&gt; i instanceof Deployment ||
                i instanceof Pod ||
                i instanceof ReplicaSet ||
                i instanceof ReplicationController).collect(Collectors.toList());
        long started = System.currentTimeMillis();
        System.out.println("Waiting until ready (" + kubernetesResource.readinessTimeout() + " ms)...");
        try {
            waitUntilCondition(context, waitables, i -&gt; Readiness.getInstance().isReady(i), kubernetesResource.readinessTimeout(),
                    TimeUnit.MILLISECONDS);
        } catch (InterruptedException e) {
            throw new IllegalStateException("Gave up waiting after " + kubernetesResource.readinessTimeout());
        }
        long ended = System.currentTimeMillis();
        System.out.println("Waited: " + (ended - started) + " ms.");
        //Display the item status
        waitables.stream().map(r -&gt; client.resource(r).fromServer().get())
                .forEach(i -&gt; {
                    if (!Readiness.getInstance().isReady(i)) {
                        readinessFailed(context);
                        System.out.println(i.getKind() + ":" + i.getMetadata().getName() + " not ready!");
                    }
                });


        if (hasReadinessFailed(context)) {
            throw new IllegalStateException("Readiness Failed");
        } else if (kubernetesResource.additionalResourcesCreated().length &gt; 0) {
            long end = started + kubernetesResource.readinessTimeout();
            Map&lt;String, ResourceGetter&gt; resourceGetters = new HashMap&lt;&gt;();
            for (org.wildfly.test.cloud.common.Resource resource : kubernetesResource.additionalResourcesCreated()) {
                if (resourceGetters.put(resource.name(), ResourceGetter.create(client, resource)) != null) {
                    throw new IllegalStateException(resource.name() + " appears more than once in additionalResourcesCreated()");
                }
            }

            Map&lt;String, HasMetadata&gt; additionalWaitables = new HashMap&lt;&gt;();
            while (System.currentTimeMillis() &lt; end) {
                for (Map.Entry&lt;String, ResourceGetter&gt; entry : resourceGetters.entrySet()) {
                    if (!additionalWaitables.containsKey(entry.getKey())) {
                        ResourceGetter getter = entry.getValue();
                        HasMetadata hasMetadata = getter.getResource();
                        if (hasMetadata != null) {
                            additionalWaitables.put(entry.getKey(), hasMetadata);
                        }
                    }
                }
                if (additionalWaitables.size() == resourceGetters.size()) {
                    break;
                }
                try {
                    Thread.sleep(1000);
                } catch (InterruptedException e) {
                    Thread.interrupted();
                    throw new IllegalStateException(e);
                }
            }

            if (additionalWaitables.size() != resourceGetters.size()) {
                throw new IllegalStateException("Could not start all items in " + kubernetesResource.readinessTimeout());
            }


            try {
                waitUntilCondition(context, additionalWaitables.values(), i -&gt; Readiness.getInstance().isReady(i), end - System.currentTimeMillis(),
                        TimeUnit.MILLISECONDS);
            } catch (InterruptedException e) {
                throw new IllegalStateException("Gave up waiting after " + (System.currentTimeMillis() - started));
            }

            waitables.stream().map(r -&gt; client.resource(r).fromServer().get())
                    .forEach(i -&gt; {
                        if (!Readiness.getInstance().isReady(i)) {
                            readinessFailed(context);
                            System.out.println(i.getKind() + ":" + i.getMetadata().getName() + " not ready!");
                        }
                    });

            if (hasReadinessFailed(context)) {
                throw new IllegalStateException("Readiness Failed");
            }
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the method that will be called after the test running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private void cleanupKubernetesResources(ExtensionContext context, WildFlyIntegrationTestConfig config, WildFlyTestContext testContext) {
        if (config.getKubernetesResources().isEmpty()) {
            return;
        }

        List&lt;KubernetesResource&gt; kubernetesResources = config.getKubernetesResources();
        for (int i = kubernetesResources.size() - 1 ; i &gt;= 0 ; i--) {
            KubernetesResource kubernetesResource = kubernetesResources.get(i);
            KubernetesList resourceList = null;
            try {
                try (InputStream in = getLocalOrRemoteKubernetesResourceInputStream(kubernetesResource.definitionLocation())) {
                    resourceList = Serialization.unmarshalAsList(in);
                }
            } catch (Exception e) {
                throw toRuntimeException(e);
            }

            List&lt;HasMetadata&gt; list = resourceList.getItems();
            Collections.reverse(list);
            list.stream().forEach(r -&gt; {
                System.out.println("Deleting: " + r.getKind() + " name:" + r.getMetadata().getName() + ". Deleted:"
                        + getKubernetesClient(context).resource(r).cascading(true).delete());
            });
        }

    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Though these are the internal implementations and the code may change in the future, it’s a good material to understand how these tools are worked together.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="references">References</h2>
<div class="sectionbody">

</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. <a href="https://developers.redhat.com/blog/2021/03/17/using-dekorate-to-generate-kubernetes-manifests-for-java-applications">Using Dekorate to generate Kubernetes manifests for Java applications / Red Hat Developer</a>
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. <a href="https://developers.redhat.com/blog/2020/01/28/introduction-to-eclipse-jkube-java-tooling-for-kubernetes-and-red-hat-openshift">Introduction to Eclipse JKube: Java tooling for Kubernetes and Red Hat OpenShift | Red Hat Developer</a>
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. <a href="https://github.com/eclipse/jkube/tree/master/jkube-kit">jkube/jkube-kit at master · eclipse/jkube</a>
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. <a href="https://weinan.io/2023/06/23/jkube.html">Using JKube To Do Kubernetes Deployment</a>
</div>
<div class="footnote" id="_footnotedef_5">
<a href="#_footnoteref_5">5</a>. <a href="https://github.com/wildfly-extras/wildfly-cloud-tests">WildFly Cloud Testsuite</a>
</div>
<div class="footnote" id="_footnotedef_6">
<a href="#_footnoteref_6">6</a>. <a href="https://weinan.io/2023/06/07/wildfly-k8s.html">Using the wildfly-cloud-tests project as an example to see how to deploy WildFly based project in cloud based environment</a>
</div>
<div class="footnote" id="_footnotedef_7">
<a href="#_footnoteref_7">7</a>. <a href="https://github.com/wildfly-extras/wildfly-cloud-tests/blob/main/images/pom.xml#L105" class="bare">https://github.com/wildfly-extras/wildfly-cloud-tests/blob/main/images/pom.xml#L105</a>
</div>
<div class="footnote" id="_footnotedef_8">
<a href="#_footnoteref_8">8</a>. <a href="https://github.com/wildfly-extras/wildfly-cloud-tests/blob/main/common/bom/pom.xml#L65">wildfly-cloud-tests/common/bom/pom.xml at main · wildfly-extras/wildfly-cloud-tests</a>
</div>
<div class="footnote" id="_footnotedef_9">
<a href="#_footnoteref_9">9</a>. <a href="https://github.com/wildfly-extras/wildfly-cloud-tests/blob/main/common/bom/pom.xml#L116" class="bare">https://github.com/wildfly-extras/wildfly-cloud-tests/blob/main/common/bom/pom.xml#L116</a>
</div>
<div class="footnote" id="_footnotedef_10">
<a href="#_footnoteref_10">10</a>. <a href="https://github.com/jbossws/jbossws-cxf/blob/main/modules/testsuite/cloud-tests/k8s/images/pom.xml#L78-L98" class="bare">https://github.com/jbossws/jbossws-cxf/blob/main/modules/testsuite/cloud-tests/k8s/images/pom.xml#L78-L98</a>
</div>
<div class="footnote" id="_footnotedef_11">
<a href="#_footnoteref_11">11</a>. <a href="https://jbossws.github.io/2023/09/08/jbossws-cloud-test-common-utilties/">The New JBossWS Kubernetes/OpenShift Test Common Utilities</a>
</div>
<div class="footnote" id="_footnotedef_12">
<a href="#_footnoteref_12">12</a>. <a href="https://github.com/jbossws/jbossws-cxf/blob/main/.github/workflows/cloud-build.yml" class="bare">https://github.com/jbossws/jbossws-cxf/blob/main/.github/workflows/cloud-build.yml</a> / Relative build process: <a href="https://github.com/jbossws/jbossws-cxf/actions/runs/6140452372/job/16659439365">JBWS-4383 Improve the common utility to check the WFLY readiness in… jbossws/jbossws-cxf@9334492</a>
</div>
<div class="footnote" id="_footnotedef_13">
<a href="#_footnoteref_13">13</a>. <a href="https://github.com/jbossws/jbossws-cxf/blob/main/modules/testsuite/cloud-tests/container/pom.xml#L114-L150">jbossws-cxf/modules/testsuite/cloud-tests/container/pom.xml at main · jbossws/jbossws-cxf</a>
</div>
<div class="footnote" id="_footnotedef_14">
<a href="#_footnoteref_14">14</a>. <a href="https://github.com/wildfly-extras/wildfly-cloud-tests/blob/main/common/junit-extension/src/main/java/org/wildfly/test/cloud/common/WildFlyCommonExtension.java" class="bare">https://github.com/wildfly-extras/wildfly-cloud-tests/blob/main/common/junit-extension/src/main/java/org/wildfly/test/cloud/common/WildFlyCommonExtension.java</a>
</div>
</div>
    
  </div>
</div>



  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img class="wf-logo" src="/assets/img/wildfly_icons_one-color-logo.png"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">WildFly is fully open. All components are open source and follow a community-focused development process.<br/><br/>This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> is hosted on <a href='https://pages.github.com/' target='_blank'>Github Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/wildfly/wildfly.org/fork' target='_blank'>fork it</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <strong>Navigation</strong>
        <ul class="footer-links width-1-12">
          
            <li><a href="/downloads">Downloads</a></li>
          
            <li><a href="https://docs.wildfly.org">Docs</a></li>
          
            <li><a href="/get-started">Get Started</a></li>
          
            <li><a href="https://github.com/wildfly/wildfly">Github</a></li>
          
            <li><a href="/guides">Guides</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <strong>Contribute</strong>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://issues.jboss.org/browse/WFLY">Submit a bug</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/wildfly">Join the forum</a></li>
          
            <li><a href="https://github.com/wildfly/wildfly/fork">Fork WildFly</a></li>
          
            <li><a href="https://twitter.com/WildFlyAS">Follow us</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <strong>Get Help</strong>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://groups.google.com/forum/#!forum/wildfly">Join the forum</a></li>
          
            <li><a href="https://wildfly.zulipchat.com/">Join Zulip Chat</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-6-12 more-links">
        <strong>Find more Red Hat Middleware Community Projects</strong>
        <ul class="footer-links">
          
            <li><a href="https://www.apiman.io/">APIMan</a></li>
          
            <li><a href="http://arquillian.org">Arquillian</a></li>
          
            <li><a href="https://github.com/ansible-middleware/wildfly">Ansible Collection for Wildfly</a></li>
          
            <li><a href="http://byteman.jboss.org/">Byteman</a></li>
          
            <li><a href="http://capedwarf.org/">CapeDwarf</a></li>
          
            <li><a href="https://github.com/alechenninger/chronicler">Chronicler</a></li>
          
            <li><a href="https://github.com/darcy-framework">Darcy</a></li>
          
            <li><a href="http://debezium.io/">Debezium</a></li>
          
            <li><a href="https://www.drools.org/">Drools</a></li>
          
            <li><a href="http://gatein.jboss.org/">GateIn</a></li>
          
            <li><a href="http://www.hawkular.org/">Hawkular</a></li>
          
            <li><a href="http://hawt.io/">Hawtio</a></li>
          
            <li><a href="http://hibernate.org/">Hibernate</a></li>
          
            <li><a href="http://www.infinispan.org/">Infinispan</a></li>
          
            <li><a href="https://developers.redhat.com/products/codeready-studio/overview">CodeReady Studio</a></li>
          
            <li><a href="http://forge.jboss.org/">JBoss Forge</a></li>
          
            <li><a href="https://github.com/jboss-logging">JBoss Logging</a></li>
          
            <li><a href="http://jbossremoting.jboss.org/">JBoss Remoting</a></li>
          
            <li><a href="https://www.jbpm.org/">jBPM</a></li>
          
            <li><a href="https://jsfunit.jboss.org/">JSFUnit</a></li>
          
            <li><a href="https://www.keycloak.org/">Keycloak</a></li>
          
            <li><a href="http://modcluster.io/">Mod Cluster</a></li>
          
            <li><a href="http://modeshape.jboss.org/">ModeShape</a></li>
          
            <li><a href="https://www.optaplanner.org/">OptaPlanner</a></li>
          
            <li><a href="https://quarkus.io/">Quarkus</a></li>
          
            <li><a href="http://resteasy.jboss.org/">RESTEasy</a></li>
          
            <li><a href="https://riftsaw.jboss.org/">Riftsaw</a></li>
          
            <li><a href="http://savara.jboss.org/">Savara</a></li>
          
            <li><a href="https://weld.cdi-spec.org/">Weld</a></li>
          
            <li><a href="http://arquillian.org/">Shrinkwrap</a></li>
          
            <li><a href="https://switchyard.jboss.org/">Switchyard</a></li>
          
            <li><a href="https://tattletale.jboss.org/">Tattletale</a></li>
          
            <li><a href="https://teiid.io/">Teiid</a></li>
          
            <li><a href="https://wildfly-security.github.io/wildfly-elytron/">WildFly Elytron</a></li>
          
            <li><a href="http://wise.jboss.org/">Wise</a></li>
          
            <li><a href="https://xnio.jboss.org/">XNIO</a></li>
          
        </ul>
      </div>
    
  </div>
</div>
  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/img/redhat_reversed.svg"></a>
    </span>
  </div>
</div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/random-color-picker.js"></script>
  <script type="text/javascript">
    if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
        _satellite.pageBottom();
    }
    hljs.highlightAll();
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script>
  <script type="text/javascript" src="/assets/javascript/copy.js"></script>

</body>

</html>
